#!/bin/bash

if [ $# -ne 2 ]; then
	echo "Usage: `basename $0` dirs files"
	exit 0
fi

dirs=$1
files=$2
top=.
systype=`uname -s`

[ -f $files ] && rm -f $files
cat $dirs | while read dir; do
	[ -z "$dir" ] && continue
	[ -z "`echo $dir | grep ^#`" ] || continue
	
	echo "==> $dir"
	if [ $systype = Linux ]; then
		find "$top/$dir" -regex ".*\.\(h\|c\|cc\|cpp\|java\)" -type f 2>/dev/null >> $files
	elif [ $systype = Darwin ]; then
		find -E "$top/$dir" -regex ".*\.(h|c|cc|cpp|java)" -type f 2>/dev/null >> $files
	fi
done
sed -i -e 's/^\.\///' $files

